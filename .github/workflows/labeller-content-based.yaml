---
name: Labeller (content-based)
"on":
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

jobs:
  labeller:
    name: Issue & PR labeller based on content
    runs-on: ubuntu-20.04
    steps:
      # XXX DEBUG info
      # I need to identify how to skip this whole labelling for issues and PRs
      # created by bots and other GitHub actions.
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
      - uses: Naturalclar/issue-action@v2.0.2
        # TODO: skip this step if this workflow was created/triggered by a bot
        # or another GitHub action. That way we can prevent content-rich PRs
        # (like those produced by dependabot) to be overly tagged with extra
        # labels.
        if: github.sender.type != 'Bot'
        # if: github.actor == 'dependabot[bot]'
        # if: github.sender.login == 'dependabot[bot]'
        with:
          parameters: >
            [
              {"labels": [
                "ğŸ”Œ xbar plugin",
                "ğŸ–¥ platform: macOS"],
               "keywords": ["xbar"]},

              {"labels": [
                "ğŸ› bug"],
               "keywords": ["bug", "error", "traceback", "fix"]},

              {"labels": [
                "ğŸ”© CI/CD"],
               "keywords": ["ci-cd", "cicd", ".github", "workflow", "actions"]},

              {"labels": [
                "ğŸ“— documentation"],
               "keywords": [
                  "sphinx", "readthedocs", "read the docs", "readme", "rst",
                  "typo"]},

              {"labels": [
                "âœ¨ enhancement"],
               "keywords": ["add"]},

              {"labels": [
                "ğŸ†˜ help wanted"],
               "keywords": ["help"]},

               {"labels": [
                  "ğŸ“¦ manager: apm",
                  "ğŸ–¥ platform: Linux",
                  "ğŸ–¥ platform: macOS",
                  "ğŸ–¥ platform: Windows"],
               "keywords": ["apm", "atom"]},

              {"labels": [
                "ğŸ“¦ manager: brew",
                "ğŸ–¥ platform: macOS",
                "ğŸ–¥ platform: Linux"],
               "keywords": ["brew", "homebrew", "tap", "formula"]},

              {"labels": [
                "ğŸ“¦ manager: cask",
                "ğŸ–¥ platform: macOS"],
               "keywords": ["cask"]},

              {"labels": [
                "ğŸ“¦ manager: choco",
                "ğŸ–¥ platform: Windows"],
              "keywords": ["choco", "chocolatey"]},

              {"labels": [
                "ğŸ“¦ manager: composer",
                "ğŸ–¥ platform: Linux",
                "ğŸ–¥ platform: macOS",
                "ğŸ–¥ platform: Windows"],
              "keywords": ["composer", "php"]},

              {"labels": [
                "ğŸ“¦ manager: dpkg-like",
                "ğŸ–¥ platform: Linux"],
               "keywords": ["apt", "apt-mint", "aptitude", "dpkg", "opkg"]},

              {"labels": [
                "ğŸ“¦ manager: flatpak",
                "ğŸ–¥ platform: Linux"],
               "keywords": ["flatpak", "flat"]},

              {"labels": [
                "ğŸ“¦ manager: gem",
                "ğŸ–¥ platform: Linux",
                "ğŸ–¥ platform: macOS",
                "ğŸ–¥ platform: Windows"],
               "keywords": ["gem", "ruby"]},

              {"labels": [
                "ğŸ“¦ manager: mas",
                "ğŸ–¥ platform: macOS"],
               "keywords": ["mas", "app store", "app-store"]},

              {"labels": [
                "ğŸ“¦ manager: npm-like",
                "ğŸ–¥ platform: Linux",
                "ğŸ–¥ platform: macOS",
                "ğŸ–¥ platform: Windows"],
               "keywords": ["npm", "node", "yarn"]},

              {"labels": [
                "ğŸ“¦ manager: pip",
                "ğŸ–¥ platform: Linux",
                "ğŸ–¥ platform: macOS",
                "ğŸ–¥ platform: Windows"],
               "keywords": ["pip"]},

              {"labels": [
                "ğŸ“¦ manager: snap",
                "ğŸ–¥ platform: Linux"],
               "keywords": ["snap"]},

              {"labels": [
                "ğŸ“¦ manager: vscode",
                "ğŸ–¥ platform: Linux",
                "ğŸ–¥ platform: macOS",
                "ğŸ–¥ platform: Windows"],
               "keywords": ["vscode"]},

              {"labels": [
                "ğŸ–¥ platform: Linux"],
               "keywords": ["linux", "ubuntu", "debian"]},

              {"labels": [
                "ğŸ–¥ platform: macOS"],
               "keywords": ["macos", "mac os", "osx", "os x", "apple"]},

              {"labels": [
                "ğŸ–¥ platform: Windows"],
               "keywords": ["windows", "c:", "microsoft"]}
            ]
          github-token: ${{ secrets.GITHUB_TOKEN }}
