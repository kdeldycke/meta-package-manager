[project]
# Docs: https://packaging.python.org/en/latest/guides/writing-pyproject-toml/
name = "meta-package-manager"
version = "5.18.0"
# Python versions and their status: https://devguide.python.org/versions/
requires-python = ">= 3.9"
description = "üéÅ wraps all package managers with a unifying CLI"
authors = [{ name = "Kevin Deldycke", email = "kevin@deldycke.com" }]
readme = "readme.md"
keywords = [
    'CLI',
    'apm',
    'apt',
    'apt-mint',
    'atom',
    'brew',
    'cargo',
    'cask',
    'choco',
    'chocotaley',
    'composer',
    'cyclonedx',
    'dnf',
    'emerge',
    'flatpak',
    'gem',
    'homebrew',
    'mac app store',
    'macos',
    'mas',
    'node',
    'npm',
    'opkg',
    'package',
    'package url',
    'pacaur',
    'pacman',
    'paru',
    'php composer',
    'pip',
    'pipx',
    'pkg',
    'plugin',
    'portage',
    'purl',
    'ruby',
    'rust',
    'sbom',
    'scoop',
    'snap',
    'spdx',
    'steamcmd',
    'uv',
    'visual studio code',
    'vscode',
    'xbar',
    'swiftbar',
    'winget',
    'yarn',
    'yay',
    'yum',
    'zypper',
]
classifiers = [
    # See: https://pypi.org/pypi?%3Aaction=list_classifiers
    'Development Status :: 5 - Production/Stable',
    'Environment :: Console',
    'Environment :: MacOS X',
    'Environment :: Plugins',
    'Intended Audience :: Developers',
    'Intended Audience :: Information Technology',
    'Intended Audience :: System Administrators',
    'License :: OSI Approved :: GNU General Public License v2 or later (GPLv2+)',
    'Operating System :: MacOS :: MacOS X',
    'Operating System :: Microsoft :: Windows',
    'Operating System :: POSIX :: Linux',
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    'Programming Language :: Python :: Implementation :: CPython',
    'Topic :: Security',
    'Topic :: Software Development :: Libraries :: Python Modules',
    'Topic :: System :: Archiving :: Packaging',
    'Topic :: System :: Installation/Setup',
    'Topic :: System :: Software Distribution',
    'Topic :: Utilities',
    'Typing :: Typed',
]
dependencies = [
    "boltons ~= 24.0.0",
    "click-extra ~= 4.9.0",
    "cyclonedx-python-lib [validation] ~= 7.5.1",
    "more-itertools ~= 10.3.0",
    "packageurl-python ~= 0.15.0",
    "spdx-tools ~= 0.8.2",
    "tabulate [widechars] ~= 0.9.0",
    "tomli ~= 2.0.1 ; python_version < '3.11'",
    "tomli_w ~= 1.0.0",
    "xmltodict ~= 0.13.0",
]

[project.optional-dependencies]
test = [
    "click-extra [pytest] ~= 4.9.0",
    "coverage [toml] ~= 7.6.0",
    "pytest ~= 8.3.1",
    "pyyaml ~= 6.0.0",
    # More pytest plugins at: https://docs.pytest.org/en/latest/reference/plugin_list.html
    "pytest-cov ~= 5.0.0",
    "pytest-github-actions-annotate-failures ~= 0.2.0",
    "pytest-randomly ~= 3.15.0",
    "pytest-xdist [psutil] ~= 3.6.1",
]
typing = [
    "types-PyYAML ~= 6.0.12.9",
    "types-tabulate ~= 0.9.0.2",
    "types-xmltodict ~= 0.13.0.2",
    "typing-extensions ~= 4.3.0 ; python_version < '3.10'",
]
docs = [
    "click-extra [sphinx] ~= 4.9.0",
    "furo ~= 2024.7.18",
    "myst-parser ~= 3.0.0",
    # Sphinx 7.2.0 is the first version to drop Python 3.8.
    "sphinx >= 7.2.0",
    "sphinx-autodoc-typehints ~= 2.2.2",
    "sphinx-click ~= 6.0.0",
    "sphinx-copybutton ~= 0.5.2",
    # sphinx-design 0.5.0 is the first to allow Sphinx 7.
    "sphinx-design ~= 0.6.0",
    "sphinx-issues ~= 4.1.0",
    "sphinxcontrib-mermaid ~= 0.9.2",
    "sphinxext-opengraph ~= 0.9.0",
    "tomli ~= 2.0.1 ; python_version < '3.11'",
]

[project.urls]
"Homepage" = 'https://github.com/kdeldycke/meta-package-manager'
"Documentation" = 'https://kdeldycke.github.io/meta-package-manager'
"Repository" = 'https://github.com/kdeldycke/meta-package-manager'
"Funding" = "https://github.com/sponsors/kdeldycke"
"Issues" = "https://github.com/kdeldycke/meta-package-manager/issues"
"Changelog" = "https://kdeldycke.github.io/meta-package-manager/changelog.html"

[project.scripts]
mpm = 'meta_package_manager.__main__:main'

[tool.nuitka]
product-name = "Meta Package Manager"
file-description = "üéÅ wraps all package managers with a unifying CLI"
copyright = "Kevin Deldycke <kevin@deldycke.com> and contributors. Distributed under GPL-2.0-or-later license."
file-version = "5.18.0"
product-version = "5.18.0"
macos-app-icon = "docs/assets/icon.png"
linux-icon = "docs/assets/icon.png"
windows-icon-from-ico = "docs/assets/icon.png"

[tool.mypy]
warn_unused_configs = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_return_any = true
warn_unreachable = true
pretty = true

[[tool.mypy.overrides]]
ignore_missing_imports = true
module = ["boltons.*", "packageurl.*"]

[tool.pytest.ini_options]
# https://docs.pytest.org/en/latest/customize.html#pyproject-toml
addopts = [
    "--numprocesses=auto",
    "--dist=loadgroup",
    # Limit size of the chunks of consecutive tests that xdist submits to workers.
    # Setting it to 1 will effectively mean "round-robin distribution".
    # Source: https://github.com/pytest-dev/pytest-xdist/issues/855#issuecomment-1344986156
    "--maxschedchunk=1",
    "--durations=10",
    "--cov-report=term",
    "--cov-report=xml",
    # XXX --run-non-destructiveis not required as this is the default behavior.
    # We would love to add it to the command line to make sure pytest is properly recognizing it and loads our
    # customization from ``./tests/conftest.py``. But because of issue
    # https://github.com/pytest-dev/pytest/issues/9311 (see above), it is not currently present in ``addopts``.
    # "--run-non-destructive",
]
# Make sure tests that are expected to fail do not resurect and start working all of a sudden.
xfail_strict = true

# https://coverage.readthedocs.io/en/latest/config.html
[tool.coverage.run]
branch = true
[tool.coverage.report]
precision = 2

[tool.bumpversion]
current_version = "5.18.0"
allow_dirty = true

[[tool.bumpversion.files]]
# Update Python package version in any __init__.py file.
glob = "./**/__init__.py"
ignore_missing_version = true

[[tool.bumpversion.files]]
# Update version in bar plugin.
filename = "./meta_package_manager/bar_plugin.py"

[[tool.bumpversion.files]]
# Update version in project section.
filename = "./pyproject.toml"
search = 'version = "{current_version}"'
replace = 'version = "{new_version}"'

[[tool.bumpversion.files]]
# Update the version in standard Markdown changelog.
filename = "./changelog.md"
search = "## [{current_version} (unreleased)]("
replace = "## [{new_version} (unreleased)]("

[[tool.bumpversion.files]]
# Update the version in the citation file.
filename = "./citation.cff"
search = "version: {current_version}"
replace = "version: {new_version}"

[[tool.bumpversion.files]]
# Update the release date in the citation file.
filename = "./citation.cff"
regex = true
search = "date-released: \\d{{4}}-\\d{{2}}-\\d{{2}}"
replace = "date-released: {utcnow:%Y-%m-%d}"

[tool.typos]
default.extend-ignore-identifiers-re = [
    # error: `ist` should be `is`, `it`, `its`, `sit`, `list`
    #   --> ./docs/development.md:121:10
    #     |
    # 121 | - [chalk.ist](https://chalk.ist)
    #     |          ^^^
    #     |
    # error: `ist` should be `is`, `it`, `its`, `sit`, `list`
    #   --> ./docs/development.md:121:29
    #     |
    # 121 | - [chalk.ist](https://chalk.ist)
    #     |                             ^^^
    #     |
    "ist",
]
